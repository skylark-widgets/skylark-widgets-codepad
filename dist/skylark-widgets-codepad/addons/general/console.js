/**
 * skylark-widgets-codepad - The skylark code playground widget for showcasing html/css/js.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-codepad/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-styler","../../addon","../../util","../../codepad"],function(e,c,t,n,o){"use strict";class i extends t{get options(){return{autoClear:!1}}_init(){super._init();var e=this.coder,t=this.options,n=`(function ${this.capture.toString()})();`,o=document.createElement("li"),i=(c.addClass(o,"codepad-nav-item codepad-nav-item-console"),o.innerHTML='<a href="#" data-codepad-type="console">JS Console</a>',document.createElement("div")),i=(c.addClass(i,"codepad-pane codepad-pane-console"),i.innerHTML=`
              <div class="codepad-console-container">
                <ul class="codepad-console-output"></ul>
                <form class="codepad-console-input">
                  <input type="text">
                </form>
              </div>
              <button class="codepad-button codepad-console-clear">Clear</button>
            `,e._velm.append(i),e._velm.find(".codepad-nav").append(o),e.$container.querySelector(".codepad-console-container")),o=e.$container.querySelector(".codepad-console-output"),s=e.$container.querySelector(".codepad-console-input input"),a=e.$container.querySelector(".codepad-console-input"),r=e.$container.querySelector(".codepad-console-clear");a.addEventListener("submit",this.submit.bind(this)),s.addEventListener("keydown",this.history.bind(this)),r.addEventListener("click",this.clear.bind(this)),!0===t.autoClear&&e.on("change",this.autoClear.bind(this),29),e.on("change",this.change.bind(this),30),window.addEventListener("message",this.getMessage.bind(this)),this.$coderContainer=e.$container,this.$container=i,this.$input=s,this.$output=o,this.history=[],this.historyIndex=0,this.logCaptureSnippet=n,this.contentCache={html:"",css:"",js:""},this.getIframe=this.getIframe.bind(this)}getIframe(){return this.$coderContainer.querySelector(".codepad-pane-result iframe")}getMessage(e){if(e.source===this.getIframe().contentWindow){var t={};try{t=JSON.parse(e.data)}catch(e){}"codepad-console-log"===t.type&&this.log(t.message)}}autoClear(e,t){var n=e.content;"js"===e.type&&(n=n.replace(this.logCaptureSnippet,"")),!0!==e.forceRender&&this.contentCache[e.type]===n||this.clear(),this.contentCache[e.type]=n}change(e){e=e.data;"js"===e.type&&-1===e.content.indexOf(this.logCaptureSnippet)&&(e.content=""+this.logCaptureSnippet+e.content)}capture(){void 0!==window.console&&void 0!==window.console.log||(window.console={log:function(){}});var e=Function.prototype.bind.call(window.console.log,window.console);window.console.log=function(){[].slice.call(arguments).forEach(function(e){window.parent.postMessage(JSON.stringify({type:"codepad-console-log",message:e}),"*")}),e.apply(e,arguments)}}log(e="",t){var n=document.createElement("li");c.addClass(n,"codepad-console-log"),void 0!==t&&c.addClass(n,"codepad-console-log-"+t),n.innerHTML=e,this.$output.appendChild(n)}submit(e){var t=this.$input.value.trim();if(""===t)return e.preventDefault();this.history.push(t),this.historyIndex=this.history.length,this.log(t,"history"),0!==t.indexOf("return")&&(t="return "+t);try{var n=this.getIframe().contentWindow.eval(`(function() {${t}})()`);this.log(n)}catch(e){this.log(e,"error")}this.$input.value="",this.$container.scrollTop=this.$container.scrollHeight,e.preventDefault()}clear(){this.$output.innerHTML=""}history(e){var t=!1,n=this.$input.selectionStart;38===e.keyCode&&0!==this.historyIndex&&0===n&&(this.historyIndex--,t=!0),40===e.keyCode&&this.historyIndex!==this.history.length-1&&n===this.$input.value.length&&(this.historyIndex++,t=!0),t&&(this.$input.value=this.history[this.historyIndex])}static get categoryName(){return"general"}static get addonName(){return"console"}}return i.register(o),i});
//# sourceMappingURL=../../sourcemaps/addons/general/console.js.map
